<style>
    input[type="radio"] {
        transform: scale(1.3);
    }
</style>
<template>
    <div class="page">
        <div class="navbar" style="background-color: #2B5875;height: 5px;">
            <div class="left top-left" style="justify-content: space-between;">
                <a href="javascript:location.reload()"
                    style="margin-left: 10px; display: inline-flex;align-items: center;">
                    <i class="icon material-icons md-only" style="font-weight: 900;font-size: 30px;">arrow_back</i>
                </a>
                <div class="title" style="font-size: 18px;">Cursos</div>
                <a style="margin-right: 10px;">
                    <i class="icon material-icons md-only" style="color: #2B5875; font-weight: 900;">arrow_back</i>
                </a>
            </div>
        </div>

        <div class="toolbar tabbar toolbar-bottom">
            <div class="toolbar-inner" style="background-color: #2B5875;" id="toolbar_down">
                <a href="#" onclick="guardarCursoCiertoFalso();"
                    style="margin: auto;color: #fff;font-weight: bold;font-size: 18px;">Guardar <i
                        class="icon material-icons md-only" style="display: inline-block;">chevron_right</i></a>
            </div>
        </div>

        <div class="page-content" style="height: 98%;border-radius: 0px !important">
            <div
                style="text-align: center; justify-content:center; margin-right:auto; margin-left:auto; width: 99%;margin-top: 30px;">
                <div style="text-align: left;">
                    <div class="list FWM-fixing-form" id="datos_form" style="width: 97%;margin-left: 10px;margin-right: 10px;">
                        <h2 style="text-align: center;" id="title_asis">Propedéutico</h2>

                        <div class="container-check">
                            <span class="span FWM-span-form">Fecha</span>
                            <span class="span FWM-span-form span-dato" id="fecha" name="Fecha"></span>
                        </div>

                        <div class="container-check">
                            <span class="span FWM-span-form" style="margin-top: 0 !important;">Nombre Instructor</span>
                            <span class="span FWM-span-form span-dato" id="nombreInstructor" name="Nombre Instructor" style="margin-top: 0 !important;"></span>
                        </div>

                        <div class="container-check">
                            <span class="span FWM-span-form" style="margin-top: 0 !important;">Nombre Candidato</span>
                            <span class="span FWM-span-form span-dato" id="nombreCandidato" name="Nombre Candidato" style="margin-top: 0 !important;"></span>
                        </div>

                        <div class="list list-strong list-outline-ios list-dividers-ios inset-md accordion-list" id="div_calificaciones" style="display: none;">
                            <ul>
                                <li class="accordion-item">
                                    <a class="item-link item-content">
                                    <div class="item-inner">
                                        <div class="item-title">Ver historia de calificaciones</div>
                                    </div>
                                    </a>
                                    <div class="accordion-item-content">
                                        <div class="block">
                                            <div class="card data-table">
                                                <div class="infinite-scroll-content">
                                                    <div class="hitii">
                                                        <div class="timeline timeline-horizontal timeline-cols-3 medium-timeline-cols-6">
                                                            <div class="timeline-year" style="padding: 0;">
                                                                <div class="timeline-month" style="padding: 0;">
                                                                    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div> 

                        <hr>
                        <h2 style="text-align: center;">Evaluación</h2>

                        <div id="evaluacion_div" style="padding-left: 10px;padding-right: 10px;">
                           
                        </div>

                        <div style="padding-left: 10px;padding-right: 10px;">
                            <div class="container_options">
                                <span class="span FWM-span-form">Puntaje:</span>
                                <span class="span FWM-span-form span-dato" id="calificacion_text" name="calif"></span>
                                <input type="hidden" id="calificacion_number">
                            </div>

                            <div class="container_options">
                                <span class="span FWM-span-form">Observaciones:</span>
                                <textarea class="FWM-input" style="font-family: 'ITC Avant Garde Gothic', sans-serif;" id="observaciones" cols="30" rows="10" onchange=""></textarea>
                            </div>

                            <div class="container_options">
                                <span class="span FWM-span-form">El candidato es Apto?:</span>
                                <input class="tgl tgl-skewed" id="cb3" type="checkbox"></input>
                                <label class="tgl-btn" data-tg-off="NO" data-tg-on="SI" for="cb3" style="font-size: 20px;border-radius: 5px;"></label>
                            </div>
                            
                            <div class="container_options">
                                <span class="span FWM-span-form">Firma Instructor:</span>
                                <input type="hidden" name="signate" id="signate" placeholder="sfirmc">
                                <input type="hidden" id="whitfirma">
                                <center>
                                    <img id="ImagenFirmaView" src="" width="70%"><br>
                                    <span id="VolverFirmar" style="display: none;"></span>
                                    <input type="button" style="position:absolute;display:none;margin:0 !important;color:white;background-color: #019cdc;top:40px;margin-left:160px !important" value="Volver a Firmar">
                                </center>
                                <div class="row align-items-stretch" style="text-align: center;">
                                    <div class="col-100 medium-50" style="min-width: 50px; border-style: none;">
                                        <span class="resize-handler"></span>
                                        <a href="#" onclick="createFirma()" data-popup=".popup-services" style="background-color: #005D99;" class="link popup-open boton-equipo" id="VolverAFirmar">Agregar Firma <i class="icon material-icons md-only" style="display: inline-block;margin-left: 12px;">border_color</i></a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="popup popup-services" style="background-color: #f0f8ff;">
                            <br>
                            <div class="popup-container" style="height: 300px;">
                                 <div class="headerPopupPhoto" style="width: 90%;display: flex;justify-content: space-between;padding-left: 20px;margin-bottom: 30px;">
                                    <a class="link popup-close" onclick="gfirma(1)" href="#">Guardar Firma</a>
                                    <a class="link" onclick="cleanFirma()" href="#">Limpiar</a>
                                    <a class="link popup-close" onclick="gClose()" href="#">Cerrar</a>
                                </div>
                                
                                <div style="display: flex;flex-direction: column;justify-content: center;align-content: center;align-items: center;">
                                    <canvas id="signature-pad" class="signature-pad" width="600" height="250" style="background-color: #fff; touch-action: none; border: 2px solid #005D99; border-radius: 15px;"></canvas>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div style="margin-bottom: 100px;"></div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    return {
        on: {
            pageInit: function () {
                app.preloader.show('red');
                var id_cedula = localStorage.getItem("IdCedula");
                databaseHandler.db.transaction(
                    function(tx){
                        tx.executeSql(
                            "Select * from datosGeneralesCurso where id_cedula= ?",
                            [id_cedula],
                            function(tx, results){
                                var item2 = results.rows.item(0);
                                $("#title_asis").html(item2.name_course+" "+item2.fecha);
                                $("#nombreCandidato").html(item2.nombreCandidato);
                                $("#fecha").html(item2.fecha);
                                $("#nombreInstructor").html(item2.nombreInstructor);
                                $("#nombreCandidato").html(item2.nombreCandidato);
                                if (item2.OpDiario == 1) {
                                    console.log("si diario")
                                    var IDCurso = localStorage.getItem("IDCurso");
                                    var FK_Becario = localStorage.getItem("FK_Becario");
                                    var empresa = localStorage.getItem("empresa");
                                    var NomJson = 'DatosEvaluacionD_'+empresa;
                                    var html = '';        
                                    app.request({
                                        url: cordova.file.dataDirectory + "jsons_capacitacion/"+NomJson+".json",
                                        method: 'GET',
                                        dataType: 'json',
                                        success: function (data) {
                                            var length = data.length;
                                            if(length == 0){
                                            } else {
                                                for (var j = 0; j < data.length; j++) {
                                                    if(data[j].FK_IDCurso == IDCurso && data[j].FK_Becario == FK_Becario){
                                                        var check = ''
                                                        data[j].apto == 1 ? check = 'checked': check = '';
                                                        html += `<div class="timeline-item">
                                                            <div class="timeline-item-date">${data[j].fecha}</div>
                                                            <div class="timeline-item-content">
                                                                <div class="timeline-item-time">Puntos Obtenidos</div>
                                                                <div class="timeline-item-text">${data[j].Valores}</div>
                                                                <div class="timeline-item-time">Calificación</div>
                                                                <div class="timeline-item-text">${data[j].califf}</div>
                                                                <div class="timeline-item-time">Observaciones</div>
                                                                <div class="timeline-item-text">${data[j].observaciones}</div>
                                                            </div>
                                                        </div>`;
                                                    }
                                                }
                                            }
                                            $(".timeline-month").html(html);
                                            app.preloader.hide();
                                        }
                                    });
                                    $("#div_calificaciones").css("display", "block")
                                } else {
                                    app.preloader.hide();
                                }
                            }
                        );
                    },
                    function(error){app.preloader.hide();},
                    function(){}
                );

                form = '';
                databaseHandler.db.transaction(
                    function(tx){
                        tx.executeSql(
                            "Select * from CAP_RespuestasSiNoPuntuacion where id_cedula= ?",
                            [id_cedula],
                            function(tx, results){
                                var length = results.rows.length;
                                var j = 0;
                                var PuntosCurso = 0;
                                let OpCorrecta = 0
                                for(var i = 0; i< length; i++){
                                    app.preloader.show('red');
                                    j++;
                                    var checked1 = '';
                                    var checked2 = '';
                                    var item3 = results.rows.item(i);
                                    item3.OpCorrecta == 1 ? OpCorrecta = item3.OpCorrecta : OpCorrecta = 0
                                    item3.Respuesta == OpCorrecta ? PuntosCurso = PuntosCurso + item3.Valor : null ;
                                    item3.Respuesta == 1 ? (checked1 = 'checked', checked2 = '') : null ;
                                    item3.Respuesta == 0 ? (checked2 = 'checked', checked1 = '') : null ;
                                    
                                    form += `
                                        <div class="container-answer-valor"><span class="span FWM-span-form span_options">${j}. ${item3.Pregunta} 
                                            </span><span class="span text-simple">Valor: ${item3.Valor} Pto.</span>
                                        </div>
                                        <div class="container-check container_options">
                                            <label for="op${item3.FK_IDPregunta}-1" id="label-op${item3.FK_IDPregunta}-1" class="radios ${checked1}"><input type="radio" id="op${item3.FK_IDPregunta}-1" style="margin-right: 15px;" onchange="validarRadioCapa(this.id,2,${item3.Valor}, ${OpCorrecta})" ${checked1}>SI</label>
                                            <label for="op${item3.FK_IDPregunta}-0" id="label-op${item3.FK_IDPregunta}-0" class="radios ${checked2}"><input type="radio" id="op${item3.FK_IDPregunta}-0" style="margin-right: 15px;" onchange="validarRadioCapa(this.id,2,${item3.Valor}, ${OpCorrecta})" ${checked2}>NO</label>
                                        </div>
                                    `;                                    
                                }
                                $("#evaluacion_div").html(form);
                                var califf = 0;
                                getCalificacionCursoValor(PuntosCurso)
                                $("#calificacion_number").val(PuntosCurso);
                                app.preloader.hide();
                            }
                        );
                    },
                    function(error){app.preloader.hide();},
                    function(){}
                );
            }
        }
    }
</script>