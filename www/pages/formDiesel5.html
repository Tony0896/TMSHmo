<style>
    #tb_diesel > tr > td {
        padding: 0;
        font-size: 20px;
        text-align: center;
    }
    .item-title {
        font-size: 25px !important;
    }
    .autocomplete-dropdown-inner {
        margin-top: 15px;
    }
    .item-inner {
        margin-bottom: 12px;
    }
</style>
<template>
    <div class="page">
        <!-- Navsbars -->
        <nav class="left top-left" style="justify-content: space-between">
            <a href="javascript:location.reload()" style="margin-left: 10px; display: inline-flex; align-items: center">
                <i class="icon material-icons md-only" style="font-weight: 900; font-size: 30px">arrow_back</i>
            </a>
            <div class="title">Carga Diesel</div>
            <a style="margin-right: 10px">
                <i class="icon material-icons md-only" style="color: #1e9fb4; font-weight: 900">arrow_back</i>
            </a>
        </nav>
        <div class="toolbar tabbar toolbar-bottom">
            <div class="toolbar-inner" style="background-color: #1e9fb4" id="toolbar_down">
                <a href="#" onclick="FinalizarCargaDiesel();" style="margin: auto; color: #fff; font-weight: bold; font-size: 18px"
                    >Finalizar Carga <i class="icon material-icons md-only" style="display: inline-block">chevron_right</i></a
                >
            </div>
        </div>
        <input type="hidden" id="modelos" />
        <input type="hidden" id="totalizadorFlag" />
        <input type="hidden" id="totalizadorReal" value="0" />
        <!-- Contenido Page -->
        <div class="page-content" style="height: 98%; border-radius: 0px !important">
            <div style="text-align: center; justify-content: center; margin-right: auto; margin-left: auto; width: 99%; margin-top: 0px">
                <div style="text-align: left">
                    <div class="list FWM-fixing-form" id="datos_form" style="margin-left: 5px; margin-right: 5px; width: 99%">
                        <h2 style="text-align: center">Diesel</h2>
                        <div style="margin: 20px 10px">
                            <div style="display: none">
                                <div class="span FWM-span-form" style="color: #000">Empresa</div>
                                <div class="span FWM-span-form" style="color: #ff0037" id="name_empresa"></div>
                            </div>

                            <div style="display: flex">
                                <div class="span FWM-span-form" style="color: #000">Fecha</div>
                                <div class="span FWM-span-form" style="color: #ff0037" id="fecha"></div>
                            </div>

                            <div style="display: flex">
                                <div class="span FWM-span-form" style="color: #000">Bomba de carga</div>
                                <div class="span FWM-span-form" style="color: #ff0037" id="bomba_def_d"></div>
                            </div>

                            <div style="display: flex">
                                <div class="span FWM-span-form" style="color: #000">Totalizador incial</div>
                                <div class="span FWM-span-form" style="color: #ff0037" id="carga_def_d"></div>
                            </div>

                            <div style="display: flex">
                                <div class="span FWM-span-form" style="color: #000">Despachador (Bombero)</div>
                                <div class="span FWM-span-form" style="color: #ff0037" id="personalM"></div>
                            </div>

                            <hr />

                            <div style="display: none" id="div_bomba2">
                                <div class="span FWM-span-form" style="color: #000">Bomba de carga 2</div>
                                <div class="span FWM-span-form" style="color: #ff0037" id="bomba_def_d2"></div>
                            </div>

                            <div style="display: none" id="div_totalizador">
                                <div class="span FWM-span-form" style="color: #000">Totalizador incial 2</div>
                                <div class="span FWM-span-form" style="color: #ff0037" id="carga_def_d2"></div>
                            </div>

                            <div style="display: none" id="div_bombero">
                                <div class="span FWM-span-form" style="color: #000">Despachador (Bombero) 2</div>
                                <div class="span FWM-span-form" style="color: #ff0037" id="personalM2"></div>
                            </div>

                            <div style="display: flex">
                                <div class="span FWM-span-form" style="color: #000">Unidades cargadas</div>
                                <div class="span FWM-span-form" style="color: #ff0037" id="unidades_cargadas">0</div>
                            </div>

                            <div style="display: none">
                                <div class="span FWM-span-form" style="color: #000; font-size: 30px">Total de litros cargados</div>
                                <div class="span FWM-span-form" style="color: #ff0037; font-size: 30px" id="total_litros">0</div>
                            </div>

                            <div>&nbsp;</div>

                            <div style="display: none">
                                <div class="span FWM-span-form" style="color: #000; font-size: 35px">Litros restantes</div>
                                <div class="span FWM-span-form" style="color: #ff0037; font-size: 35px" id="carga_restantes"></div>
                            </div>

                            <div>&nbsp;</div>

                            <div>
                                <span class="span FWM-span-form">Busca una Unidad</span>
                                <div style="display: flex">
                                    <input
                                        type="text"
                                        inputmode="numeric"
                                        placeholder="Escribe el eco de la unidad"
                                        id="autocomplete"
                                        class="FWM-input autocomplete-dropdown item-title"
                                        style="
                                            padding-right: 5px;
                                            font-size: 35px !important;
                                            height: 60px !important;
                                            background-color: #fdfeff !important;
                                            border: 2px solid #3498db !important;
                                        "
                                    />
                                    <span style="min-width: 20%; padding-left: 10px">
                                        <button
                                            class="col button button-small button-round button-outline"
                                            style="height: 100%; border-color: #ff0037"
                                            id="btn_llamarUnidad"
                                            onclick="llamarUnidadDiesel();"
                                        >
                                            <i class="material-icons md-light" style="color: #ff0037; vertical-align: middle; font-size: 45px"
                                                >play_circle_outline</i
                                            >
                                        </button>
                                    </span>
                                </div>
                            </div>

                            <hr style="margin-top: 25px; margin-bottom: 25px" />

                            <div id="tb_registros">
                                <div class="span FWM-span-form" style="color: #000">Unidades Cargadas</div>
                                <div class="card data-table">
                                    <div class="infinite-scroll-content">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th
                                                        class="numeric-cell"
                                                        style="text-align: center; background-color: #005d99; color: white; font-weight: bold"
                                                        id="thtema"
                                                    >
                                                        Unidad
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="text-align: center; background-color: #005d99; color: white; font-weight: bold"
                                                        id="thtema"
                                                    >
                                                        Carga
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="text-align: center; background-color: #005d99; color: white; font-weight: bold"
                                                        id="thtema"
                                                    >
                                                        Kilometrjae
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="text-align: center; background-color: #005d99; color: white; font-weight: bold"
                                                        id="thtema"
                                                    >
                                                        Bomba
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="text-align: center; background-color: #005d99; color: white; font-weight: bold"
                                                        id="thtema"
                                                    >
                                                        Tipo de Carga
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="text-align: center; background-color: #005d99; color: white; font-weight: bold"
                                                        id="thtema"
                                                    >
                                                        Editar
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="tb_diesel"></tbody>
                                        </table>
                                        <div
                                            id="message-nr"
                                            style="
                                                width: 100%;
                                                text-align: center;
                                                font-family: 'ITC Avant Garde Gothic', sans-serif;
                                                font-size: 16px;
                                            "
                                            style="display: none"
                                        >
                                            <p>Sin registros</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr style="margin-top: 25px; margin-bottom: 25px" />
                        </div>
                    </div>
                </div>
                <!-- modal inserts -->
                <div
                    class="sheet-modal my-sheet"
                    id="sheet-modal"
                    name="sheet"
                    data-close-on-escape="false"
                    data-swipe-to-close="false"
                    data-close-by-outside-click="false"
                    data-close-by-backdrop-click="false"
                    data-sheet="my-sheet"
                >
                    <div class="toolbar">
                        <div class="toolbar-inner">
                            <div class="left"></div>
                            <div class="right">
                                <a class="link" id="close_sheet" href="#">Cerrar</a>
                            </div>
                        </div>
                    </div>
                    <div class="sheet-modal-inner" style="overflow-y: scroll">
                        <div class="block">
                            <div class="list FWM-fixing-form" style="margin-top: 25px">
                                <input type="hidden" id="id_unidad" />
                                <input type="hidden" id="eco" />
                                <input type="hidden" id="pasa" value="0" />
                                <input type="hidden" id="VIN" />

                                <h3 class="FWN-titulo-2" id="title_unidad">Unidad:</h3>
                                <hr />

                                <span class="span FWM-span-form">Bomba de carga</span>
                                <select
                                    class="FWM-input obligatorio"
                                    id="bomba_c"
                                    style="
                                        padding: 10px;
                                        font-size: 35px !important;
                                        height: 60px !important;
                                        background-color: #e7f0f8 !important;
                                        border: 2px solid #3498db !important;
                                    "
                                    onchange="reviewTotalizador(this.value)"
                                >
                                    <option value="0" selected>Selecciona una opción</option>
                                    <option value="Bomba 1">Bomba 1</option>
                                    <option value="Bomba 2">Bomba 2</option>
                                    <option value="Bomba 3">Bomba 3</option>
                                    <option value="Bomba 4">Bomba 4</option>
                                    <option value="Bomba 5">Bomba 5</option>
                                </select>
                                <span class="span FWM-span-form span_Flagtotalizador" style="color: #ff0037"></span>

                                <span class="span FWM-span-form">Almacen</span>
                                <input type="text" id="almacen" class="FWM-input" style="padding-right: 5px" maxlength="255" value="DIESEL" />

                                <span class="span FWM-span-form">Tipo de Carga</span>
                                <select class="FWM-input obligatorio" id="tipo_carga">
                                    <option value="Normal" selected>Normal</option>
                                    <option value="Extra">Extra</option>
                                    <option value="Extra2">Extra 2</option>
                                </select>

                                <span class="span FWM-span-form">Cantidad de litros cargados</span>
                                <input
                                    type="number"
                                    id="carga"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="4"
                                    min="1"
                                    step=".01"
                                    onchange="validaLitros(this.value)"
                                    oninput="lengthCargas(this.id)"
                                />

                                <span class="span FWM-span-form">Kilometraje</span>
                                <input
                                    type="text"
                                    inputmode="numeric"
                                    id="odometro"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    step=".01"
                                    oninput="checkLengtNumber(this.id)"
                                />

                                <span class="span FWM-span-form">Totalizador</span>
                                <input
                                    type="text"
                                    inputmode="numeric"
                                    id="totalizador"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    step=".01"
                                    oninput="checkLengtNumber(this.id)"
                                />

                                <span class="span FWM-span-form">Operador</span>
                                <input type="text" id="operador" class="FWM-input" style="padding-right: 5px" maxlength="255" />
                                <input type="hidden" id="id_operador" />
                                <input type="hidden" id="operador2" />
                                <input type="hidden" id="id_operador1" />
                                <input type="hidden" id="operador1" />
                                <input type="hidden" id="operador11" />

                                <input type="hidden" id="Id_Empresa" />

                                <span class="span FWM-span-form">Jornada</span>
                                <input type="text" id="jornada" class="FWM-input" style="padding-right: 5px" maxlength="50" value="N/A" />

                                <span class="span FWM-span-form">Vueltas</span>
                                <input type="number" id="vueltas" class="FWM-input" style="padding-right: 5px" maxlength="20" />

                                <span class="span FWM-span-form">Hora Inicio</span>
                                <input type="time" id="h_inicio" class="FWM-input" style="padding-right: 5px" maxlength="20" />

                                <span class="span FWM-span-form">Hora Fin</span>
                                <input
                                    type="time"
                                    id="h_fin"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    onchange="check_hours_menores('h_inicio','h_fin');"
                                />

                                <span class="span FWM-span-form">Comentarios</span>
                                <input type="text" id="comentariosDiesel" class="FWM-input" style="padding-right: 5px" />

                                <div class="block grid-resizable-demo" style="margin-bottom: 70px">
                                    <div class="row align-items-stretch" style="text-align: center">
                                        <div class="col-100 medium-50" style="min-width: 50px; border-style: none">
                                            <span class="resize-handler"></span>
                                            <a href="#" onclick="agregaCarga();" style="background-color: #ff0037" class="boton-equipo">Guardar</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- modal updates -->
                <div
                    class="sheet-modal my-sheet-u"
                    id="sheet-modal-u"
                    name="sheet"
                    data-close-on-escape="false"
                    data-swipe-to-close="false"
                    data-close-by-outside-click="false"
                    data-close-by-backdrop-click="false"
                    data-sheet="my-sheet-u"
                >
                    <div class="toolbar">
                        <div class="toolbar-inner">
                            <div class="left"></div>
                            <div class="right">
                                <a class="link" id="close_sheet_u" href="#">Cerrar</a>
                            </div>
                        </div>
                    </div>
                    <div class="sheet-modal-inner" style="overflow-y: scroll">
                        <div class="block">
                            <div class="list FWM-fixing-form" id="div_cboxs" style="margin-top: 25px">
                                <input type="hidden" id="id_unidad_u" />
                                <input type="hidden" id="pasa_u" value="0" />
                                <input type="hidden" id="id_detalle_u" />
                                <input type="hidden" id="VIN_u" />

                                <h3 class="FWN-titulo-2" id="title_unidad_u">Unidad:</h3>
                                <hr />

                                <span class="span FWM-span-form">Unidad</span>
                                <input type="text" id="unidad_u" class="FWM-input" style="padding-right: 5px" maxlength="255" />

                                <span class="span FWM-span-form">Bomba de carga</span>
                                <select
                                    class="FWM-input obligatorio"
                                    id="bomba_u"
                                    style="
                                        padding: 10px;
                                        font-size: 35px !important;
                                        height: 60px !important;
                                        background-color: #e7f0f8 !important;
                                        border: 2px solid #3498db !important;
                                    "
                                    onchange="reviewTotalizador(this.value)"
                                >
                                    <option value="0">Selecciona una opción</option>
                                    <option value="Bomba 1">Bomba 1</option>
                                    <option value="Bomba 2">Bomba 2</option>
                                    <option value="Bomba 3">Bomba 3</option>
                                    <option value="Bomba 4">Bomba 4</option>
                                    <option value="Bomba 5">Bomba 5</option>
                                </select>
                                <span class="span FWM-span-form span_Flagtotalizador" style="color: #ff0037"></span>

                                <span class="span FWM-span-form">Almacen</span>
                                <input type="text" id="almacen_u" class="FWM-input" style="padding-right: 5px" maxlength="255" />

                                <span class="span FWM-span-form">Tipo de Carga</span>
                                <select class="FWM-input obligatorio" id="tipo_carga_u">
                                    <option value="Normal" selected>Normal</option>
                                    <option value="Extra">Extra</option>
                                    <option value="Extra2">Extra 2</option>
                                </select>

                                <span class="span FWM-span-form">Cantidad de litros cargados</span>
                                <input
                                    type="number"
                                    id="carga_u"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="4"
                                    min="1"
                                    step=".01"
                                    onchange="validaLitros(this.value)"
                                    oninput="lengthCargas(this.id)"
                                />

                                <span class="span FWM-span-form">Kilometraje</span>
                                <input
                                    type="text"
                                    inputmode="numeric"
                                    id="odometro_u"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    step=".01"
                                    oninput="checkLengtNumber(this.id)"
                                />

                                <span class="span FWM-span-form">Totalizador</span>
                                <input
                                    type="text"
                                    inputmode="numeric"
                                    id="totalizador_u"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    step=".01"
                                    oninput="checkLengtNumber(this.id)"
                                />

                                <span class="span FWM-span-form">Operador</span>
                                <input type="text" id="operador_u" class="FWM-input" style="padding-right: 5px" maxlength="255" />
                                <input type="hidden" id="id_operador_u" />
                                <input type="hidden" id="operador2_u" />
                                <input type="hidden" id="Id_Empresa_u" />

                                <span class="span FWM-span-form">Jornada</span>
                                <input type="text" id="jornada_u" class="FWM-input" style="padding-right: 5px" maxlength="50" />

                                <span class="span FWM-span-form">Vueltas</span>
                                <input type="number" id="vueltas_u" class="FWM-input" style="padding-right: 5px" maxlength="20" />

                                <span class="span FWM-span-form">Hora Inicio</span>
                                <input type="time" id="h_inicio_u" class="FWM-input" style="padding-right: 5px" maxlength="20" />

                                <span class="span FWM-span-form">Hora Fin</span>
                                <input
                                    type="time"
                                    id="h_fin_u"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    onchange="check_hours_menores('h_inicio_u','h_fin_u');"
                                />

                                <span class="span FWM-span-form">Comentarios</span>
                                <input type="text" id="comentariosDiesel_u" class="FWM-input" style="padding-right: 5px" />

                                <div class="block grid-resizable-demo" style="margin-bottom: 70px">
                                    <div class="row align-items-stretch" style="text-align: center">
                                        <div class="col-100 medium-50" style="min-width: 50px; border-style: none">
                                            <span class="resize-handler"></span>
                                            <a href="#" onclick="actualizaCargaDiesel();" style="background-color: #ff0037" class="boton-equipo"
                                                >Guardar</a
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- fin modals -->
            </div>
            <div style="height: 100px"></div>
        </div>
    </div>
</template>
<script>
    return {
        on: {
            pageInit: function () {
                var empresa = localStorage.getItem("empresa");
                var self = this;
                var app = self.$app;
                var NomJson = "Unidades_empresa" + empresa;
                var NomDescCli = "Unidades_empresa" + empresa;
                var accion = 0;

                app.preloader.show("red");

                databaseHandler.db.transaction(
                    function (tx5) {
                        tx5.executeSql(
                            "SELECT fecha, id_empresa, bomba_def, carga_def, personal,bomba_def2, carga_def2, personal2, fecha_corta FROM datos_generales_diesel WHERE id_cedula = ?",
                            [localStorage.getItem("IdCedula")],
                            function (tx5, results) {
                                var item = results.rows.item(0);
                                var fecha = item.fecha_corta;
                                $("#name_empresa").html(NombreEmpresa(item.id_empresa));
                                $("#bomba_def_d").html(item.bomba_def);
                                $("#carga_def_d").html(numberWithCommas(Number(item.carga_def)));
                                $("#fecha").html(fecha);
                                $("#personalM").html(item.personal);
                                let option = `<option value="0">Selecciona una opción</option> <option value="${item.bomba_def}">${item.bomba_def}</option>`;
                                $("#bomba_c").html(option);
                                $("#bomba_u").html(option);
                                if (item.bomba_def2 != 0) {
                                    $("#bomba_c").append(`<option value="${item.bomba_def2}">${item.bomba_def2}</option>`);
                                    $("#bomba_u").append(`<option value="${item.bomba_def2}">${item.bomba_def2}</option>`);
                                    $("#div_bomba2").css("display", "flex");
                                    $("#div_totalizador").css("display", "flex");
                                    $("#div_bombero").css("display", "flex");
                                    $("#bomba_def_d2").html(item.bomba_def2);
                                    $("#carga_def_d2").html(numberWithCommas(Number(item.carga_def2)));
                                    $("#personalM2").html(item.personal2);
                                }
                            },
                            function (tx5, error) {
                                console.error("Error: " + error.message);
                            }
                        );
                    },
                    function (error) {
                        console.error("Error: " + error.message);
                    },
                    function (error) {
                        console.error("Error: " + error.message);
                    }
                );

                var id_cedula = localStorage.getItem("IdCedula");
                databaseHandler.db.transaction(
                    function (tx5) {
                        tx5.executeSql(
                            "SELECT * FROM detalle_diesel WHERE id_cedula = ?",
                            [id_cedula],
                            function (tx5, results) {
                                var length = results.rows.length;
                                if (length == 0) {
                                    $("#message-nr").css("display", "block");
                                    $("#total_litros").html(`${numberWithCommas(0)}`);
                                    $("#carga_restantes").html(
                                        `${numberWithCommas(Number(String($("#carga_def_d").html()).replaceAll(",", "")).toFixed(2))}`
                                    );
                                    app.preloader.hide();
                                } else {
                                    $("#message-nr").css("display", "none");
                                    for (var i = 0; i < length; i++) {
                                        var item2 = results.rows.item(i);
                                        var no_bomba = "";
                                        item2.no_bomba ? (no_bomba = item2.no_bomba) : (no_bomba = 0);
                                        $("#tb_diesel").append(
                                            `<tr><td>${item2.eco2}</td><td>${
                                                Number(item2.carga_total) > 0
                                                    ? numberWithCommas(item2.carga_total)
                                                    : '<span style="color:#FF0037"> SIN CARGA </span>'
                                            }</td><td>${numberWithCommas(item2.odometro)}</td><td>${no_bomba}</td><td>${item2.tipo_carga}</td><td>${
                                                item2.totalizador
                                            }</td></tr>`
                                        );
                                    }
                                    databaseHandler.db.transaction(
                                        function (tx5) {
                                            tx5.executeSql(
                                                "SELECT SUM(carga_total) as carga_totales, COUNT(id_cedula) as cuentas FROM detalle_diesel WHERE id_cedula = ?",
                                                [id_cedula],
                                                function (tx5, results) {
                                                    var item3 = results.rows.item(0);
                                                    $("#total_litros").html(`${numberWithCommas(Number(item3.carga_totales).toFixed(2))}`);
                                                    $("#carga_restantes").html(
                                                        `${numberWithCommas(
                                                            Number(String($("#carga_def_d").html()).replaceAll(",", "")).toFixed(2) -
                                                                Number(item3.carga_totales).toFixed(2)
                                                        )}`
                                                    );
                                                    $("#unidades_cargadas").html(`${item3.cuentas}`);
                                                    $("#tb_diesel").append(
                                                        `<tr id="row_totales" style="text-align: center;background-color: #005D99;color: white;font-weight: bold;"><th>Totales</th><th>${numberWithCommas(
                                                            Number(item3.carga_totales).toFixed(2)
                                                        )}</th><th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th></tr>`
                                                    );
                                                    $("#autocomplete").val("");
                                                    app.preloader.hide();
                                                },
                                                function (tx5, error) {
                                                    console.error("Error: " + error.message);
                                                }
                                            );
                                        },
                                        function (error) {
                                            console.error("Error: " + error.message);
                                        },
                                        function (error) {
                                            console.error("Error: " + error.message);
                                        }
                                    );
                                }
                            },
                            function (tx5, error) {
                                console.error("Error: " + error.message);
                            }
                        );
                    },
                    function (error) {
                        console.error("Error: " + error.message);
                    },
                    function (error) {
                        console.error("Error: " + error.message);
                    }
                );
            },
        },
    };
</script>
