<style>
    #tb_diesel > tr > td {
        padding: 0;
        font-size: 20px;
        text-align: center;
    }
    .item-title {
        font-size: 25px !important;
    }
    .autocomplete-dropdown-inner {
        margin-top: 15px;
    }
    .item-inner {
        margin-bottom: 12px;
    }
</style>
<template>
    <div class="page">
        <!-- Navsbars -->
        <nav class="left top-left" style="justify-content: space-between">
            <a
                href="javascript:location.reload()"
                style="
                    margin-left: 10px;
                    display: inline-flex;
                    align-items: center;
                "
            >
                <i
                    class="icon material-icons md-only"
                    style="font-weight: 900; font-size: 30px"
                    >arrow_back</i
                >
            </a>
            <div class="title">Carga Diesel</div>
            <a style="margin-right: 10px">
                <i
                    class="icon material-icons md-only"
                    style="color: #1e9fb4; font-weight: 900"
                    >arrow_back</i
                >
            </a>
        </nav>
        <div class="toolbar tabbar toolbar-bottom">
            <div
                class="toolbar-inner"
                style="background-color: #1e9fb4"
                id="toolbar_down"
            >
                <a
                    href="#"
                    onclick="FinalizarCargaDiesel();"
                    style="
                        margin: auto;
                        color: #fff;
                        font-weight: bold;
                        font-size: 18px;
                    "
                    >Finalizar Carga
                    <i
                        class="icon material-icons md-only"
                        style="display: inline-block"
                        >chevron_right</i
                    ></a
                >
            </div>
        </div>
        <input type="hidden" id="modelos" />
        <input type="hidden" id="totalizadorFlag" />
        <input type="hidden" id="totalizadorReal" value="0" />
        <!-- Contenido Page -->
        <div
            class="page-content"
            style="height: 98%; border-radius: 0px !important"
        >
            <div
                style="
                    text-align: center;
                    justify-content: center;
                    margin-right: auto;
                    margin-left: auto;
                    width: 99%;
                    margin-top: 0px;
                "
            >
                <div style="text-align: left">
                    <div
                        class="list FWM-fixing-form"
                        id="datos_form"
                        style="margin-left: 5px; margin-right: 5px; width: 99%"
                    >
                        <h2 style="text-align: center">Diesel</h2>
                        <div style="margin: 20px 10px">
                            <div style="display: none">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Empresa
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037"
                                    id="name_empresa"
                                ></div>
                            </div>

                            <div style="display: flex">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Fecha
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037"
                                    id="fecha"
                                ></div>
                            </div>

                            <div style="display: flex">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Bomba de carga
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037"
                                    id="bomba_def_d"
                                ></div>
                            </div>

                            <div style="display: flex">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Totalizador incial
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037"
                                    id="carga_def_d"
                                ></div>
                            </div>

                            <div style="display: flex">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Despachador (Bombero)
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037"
                                    id="personalM"
                                ></div>
                            </div>

                            <hr />

                            <div style="display: none" id="div_bomba2">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Bomba de carga 2
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037"
                                    id="bomba_def_d2"
                                ></div>
                            </div>

                            <div style="display: none" id="div_totalizador">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Totalizador incial 2
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037"
                                    id="carga_def_d2"
                                ></div>
                            </div>

                            <div style="display: none" id="div_bombero">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Despachador (Bombero) 2
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037"
                                    id="personalM2"
                                ></div>
                            </div>

                            <div style="display: flex">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Unidades cargadas
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037"
                                    id="unidades_cargadas"
                                >
                                    0
                                </div>
                            </div>

                            <div style="display: none">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000; font-size: 30px"
                                >
                                    Total de litros cargados
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037; font-size: 30px"
                                    id="total_litros"
                                >
                                    0
                                </div>
                            </div>

                            <div>&nbsp;</div>

                            <div style="display: none">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000; font-size: 35px"
                                >
                                    Litros restantes
                                </div>
                                <div
                                    class="span FWM-span-form"
                                    style="color: #ff0037; font-size: 35px"
                                    id="carga_restantes"
                                ></div>
                            </div>

                            <div>&nbsp;</div>

                            <div>
                                <span class="span FWM-span-form"
                                    >Busca una Unidad</span
                                >
                                <div style="display: flex">
                                    <input
                                        type="text"
                                        inputmode="numeric"
                                        placeholder="Escribe el eco de la unidad"
                                        id="autocomplete"
                                        class="FWM-input autocomplete-dropdown item-title"
                                        style="
                                            padding-right: 5px;
                                            font-size: 35px !important;
                                            height: 60px !important;
                                            background-color: #fdfeff !important;
                                            border: 2px solid #3498db !important;
                                        "
                                    />
                                    <span
                                        style="
                                            min-width: 20%;
                                            padding-left: 10px;
                                        "
                                    >
                                        <button
                                            class="col button button-small button-round button-outline"
                                            style="
                                                height: 100%;
                                                border-color: #ff0037;
                                            "
                                            id="btn_llamarUnidad"
                                            onclick="llamarUnidadDiesel();"
                                        >
                                            <i
                                                class="material-icons md-light"
                                                style="
                                                    color: #ff0037;
                                                    vertical-align: middle;
                                                    font-size: 45px;
                                                "
                                                >play_circle_outline</i
                                            >
                                        </button>
                                    </span>
                                </div>
                            </div>

                            <hr style="margin-top: 25px; margin-bottom: 25px" />

                            <div id="tb_registros">
                                <div
                                    class="span FWM-span-form"
                                    style="color: #000"
                                >
                                    Unidades Cargadas
                                </div>
                                <div class="card data-table">
                                    <div class="infinite-scroll-content">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th
                                                        class="numeric-cell"
                                                        style="
                                                            text-align: center;
                                                            background-color: #005d99;
                                                            color: white;
                                                            font-weight: bold;
                                                        "
                                                        id="thtema"
                                                    >
                                                        Unidad
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="
                                                            text-align: center;
                                                            background-color: #005d99;
                                                            color: white;
                                                            font-weight: bold;
                                                        "
                                                        id="thtema"
                                                    >
                                                        Carga
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="
                                                            text-align: center;
                                                            background-color: #005d99;
                                                            color: white;
                                                            font-weight: bold;
                                                        "
                                                        id="thtema"
                                                    >
                                                        Kilometrjae
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="
                                                            text-align: center;
                                                            background-color: #005d99;
                                                            color: white;
                                                            font-weight: bold;
                                                        "
                                                        id="thtema"
                                                    >
                                                        Bomba
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="
                                                            text-align: center;
                                                            background-color: #005d99;
                                                            color: white;
                                                            font-weight: bold;
                                                        "
                                                        id="thtema"
                                                    >
                                                        Tipo de Carga
                                                    </th>
                                                    <th
                                                        class="numeric-cell"
                                                        style="
                                                            text-align: center;
                                                            background-color: #005d99;
                                                            color: white;
                                                            font-weight: bold;
                                                        "
                                                        id="thtema"
                                                    >
                                                        Editar
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="tb_diesel"></tbody>
                                        </table>
                                        <div
                                            id="message-nr"
                                            style="
                                                width: 100%;
                                                text-align: center;
                                                font-family: 'ITC Avant Garde Gothic',
                                                    sans-serif;
                                                font-size: 16px;
                                            "
                                            style="display: none"
                                        >
                                            <p>Sin registros</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr style="margin-top: 25px; margin-bottom: 25px" />
                        </div>
                    </div>
                </div>
                <!-- modal inserts -->
                <div
                    class="sheet-modal my-sheet"
                    id="sheet-modal"
                    name="sheet"
                    data-close-on-escape="false"
                    data-swipe-to-close="false"
                    data-close-by-outside-click="false"
                    data-close-by-backdrop-click="false"
                    data-sheet="my-sheet"
                >
                    <div class="toolbar">
                        <div class="toolbar-inner">
                            <div class="left"></div>
                            <div class="right">
                                <a class="link" id="close_sheet" href="#"
                                    >Cerrar</a
                                >
                            </div>
                        </div>
                    </div>
                    <div class="sheet-modal-inner" style="overflow-y: scroll">
                        <div class="block">
                            <div
                                class="list FWM-fixing-form"
                                style="margin-top: 25px"
                            >
                                <input type="hidden" id="id_unidad" />
                                <input type="hidden" id="eco" />
                                <input type="hidden" id="pasa" value="0" />
                                <input type="hidden" id="VIN" />

                                <h3 class="FWN-titulo-2" id="title_unidad">
                                    Unidad:
                                </h3>
                                <hr />

                                <span class="span FWM-span-form"
                                    >Bomba de carga</span
                                >
                                <select
                                    class="FWM-input obligatorio"
                                    id="bomba_c"
                                    style="
                                        padding: 10px;
                                        font-size: 35px !important;
                                        height: 60px !important;
                                        background-color: #e7f0f8 !important;
                                        border: 2px solid #3498db !important;
                                    "
                                    onchange="reviewTotalizador(this.value)"
                                >
                                    <option value="0" selected>
                                        Selecciona una opción
                                    </option>
                                    <option value="Bomba 1">Bomba 1</option>
                                    <option value="Bomba 2">Bomba 2</option>
                                    <option value="Bomba 3">Bomba 3</option>
                                    <option value="Bomba 4">Bomba 4</option>
                                    <option value="Bomba 5">Bomba 5</option>
                                </select>
                                <span
                                    class="span FWM-span-form span_Flagtotalizador"
                                    style="color: #ff0037"
                                ></span>

                                <span class="span FWM-span-form">Almacen</span>
                                <input
                                    type="text"
                                    id="almacen"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="255"
                                    value="DIESEL"
                                />

                                <span class="span FWM-span-form"
                                    >Tipo de Carga</span
                                >
                                <select
                                    class="FWM-input obligatorio"
                                    id="tipo_carga"
                                >
                                    <option value="Normal" selected>
                                        Normal
                                    </option>
                                    <option value="Extra">Extra</option>
                                    <option value="Extra2">Extra 2</option>
                                </select>

                                <span class="span FWM-span-form"
                                    >Cantidad de litros cargados</span
                                >
                                <input
                                    type="number"
                                    id="carga"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="4"
                                    min="1"
                                    step=".01"
                                    onchange="validaLitros(this.value)"
                                    oninput="lengthCargas(this.id)"
                                />

                                <span class="span FWM-span-form"
                                    >Kilometraje</span
                                >
                                <input
                                    type="text"
                                    inputmode="numeric"
                                    id="odometro"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    step=".01"
                                    oninput="checkLengtNumber(this.id)"
                                />

                                <span class="span FWM-span-form"
                                    >Totalizador</span
                                >
                                <input
                                    type="text"
                                    inputmode="numeric"
                                    id="totalizador"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    step=".01"
                                    oninput="checkLengtNumber(this.id)"
                                />

                                <span class="span FWM-span-form">Operador</span>
                                <input
                                    type="text"
                                    id="operador"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="255"
                                />
                                <input type="hidden" id="id_operador" />
                                <input type="hidden" id="operador2" />
                                <input type="hidden" id="Id_Empresa" />

                                <span class="span FWM-span-form">Jornada</span>
                                <input
                                    type="text"
                                    id="jornada"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="50"
                                    value="N/A"
                                />

                                <span class="span FWM-span-form">Vueltas</span>
                                <input
                                    type="number"
                                    id="vueltas"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                />

                                <span class="span FWM-span-form"
                                    >Hora Inicio</span
                                >
                                <input
                                    type="time"
                                    id="h_inicio"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                />

                                <span class="span FWM-span-form">Hora Fin</span>
                                <input
                                    type="time"
                                    id="h_fin"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    onchange="check_hours_menores('h_inicio','h_fin');"
                                />

                                <span class="span FWM-span-form"
                                    >Comentarios</span
                                >
                                <input
                                    type="text"
                                    id="comentariosDiesel"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                />

                                <div
                                    class="block grid-resizable-demo"
                                    style="margin-bottom: 70px"
                                >
                                    <div
                                        class="row align-items-stretch"
                                        style="text-align: center"
                                    >
                                        <div
                                            class="col-100 medium-50"
                                            style="
                                                min-width: 50px;
                                                border-style: none;
                                            "
                                        >
                                            <span class="resize-handler"></span>
                                            <a
                                                href="#"
                                                onclick="agregaCarga();"
                                                style="
                                                    background-color: #ff0037;
                                                "
                                                class="boton-equipo"
                                                >Guardar</a
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- modal updates -->
                <div
                    class="sheet-modal my-sheet-u"
                    id="sheet-modal-u"
                    name="sheet"
                    data-close-on-escape="false"
                    data-swipe-to-close="false"
                    data-close-by-outside-click="false"
                    data-close-by-backdrop-click="false"
                    data-sheet="my-sheet-u"
                >
                    <div class="toolbar">
                        <div class="toolbar-inner">
                            <div class="left"></div>
                            <div class="right">
                                <a class="link" id="close_sheet_u" href="#"
                                    >Cerrar</a
                                >
                            </div>
                        </div>
                    </div>
                    <div class="sheet-modal-inner" style="overflow-y: scroll">
                        <div class="block">
                            <div
                                class="list FWM-fixing-form"
                                id="div_cboxs"
                                style="margin-top: 25px"
                            >
                                <input type="hidden" id="id_unidad_u" />
                                <input type="hidden" id="pasa_u" value="0" />
                                <input type="hidden" id="id_detalle_u" />
                                <input type="hidden" id="VIN_u" />

                                <h3 class="FWN-titulo-2" id="title_unidad_u">
                                    Unidad:
                                </h3>
                                <hr />

                                <span class="span FWM-span-form">Unidad</span>
                                <input
                                    type="text"
                                    id="unidad_u"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="255"
                                />

                                <span class="span FWM-span-form"
                                    >Bomba de carga</span
                                >
                                <select
                                    class="FWM-input obligatorio"
                                    id="bomba_u"
                                    style="
                                        padding: 10px;
                                        font-size: 35px !important;
                                        height: 60px !important;
                                        background-color: #e7f0f8 !important;
                                        border: 2px solid #3498db !important;
                                    "
                                    onchange="reviewTotalizador(this.value)"
                                >
                                    <option value="0">
                                        Selecciona una opción
                                    </option>
                                    <option value="Bomba 1">Bomba 1</option>
                                    <option value="Bomba 2">Bomba 2</option>
                                    <option value="Bomba 3">Bomba 3</option>
                                    <option value="Bomba 4">Bomba 4</option>
                                    <option value="Bomba 5">Bomba 5</option>
                                </select>
                                <span
                                    class="span FWM-span-form span_Flagtotalizador"
                                    style="color: #ff0037"
                                ></span>

                                <span class="span FWM-span-form">Almacen</span>
                                <input
                                    type="text"
                                    id="almacen_u"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="255"
                                />

                                <span class="span FWM-span-form"
                                    >Tipo de Carga</span
                                >
                                <select
                                    class="FWM-input obligatorio"
                                    id="tipo_carga_u"
                                >
                                    <option value="Normal" selected>
                                        Normal
                                    </option>
                                    <option value="Extra">Extra</option>
                                    <option value="Extra2">Extra 2</option>
                                </select>

                                <span class="span FWM-span-form"
                                    >Cantidad de litros cargados</span
                                >
                                <input
                                    type="number"
                                    id="carga_u"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="4"
                                    min="1"
                                    step=".01"
                                    onchange="validaLitros(this.value)"
                                    oninput="lengthCargas(this.id)"
                                />

                                <span class="span FWM-span-form"
                                    >Kilometraje</span
                                >
                                <input
                                    type="text"
                                    inputmode="numeric"
                                    id="odometro_u"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    step=".01"
                                    oninput="checkLengtNumber(this.id)"
                                />

                                <span class="span FWM-span-form"
                                    >Totalizador</span
                                >
                                <input
                                    type="text"
                                    inputmode="numeric"
                                    id="totalizador_u"
                                    class="FWM-input input-resalte"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    step=".01"
                                    oninput="checkLengtNumber(this.id)"
                                />

                                <span class="span FWM-span-form">Operador</span>
                                <input
                                    type="text"
                                    id="operador_u"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="255"
                                />
                                <input type="hidden" id="id_operador_u" />
                                <input type="hidden" id="operador2_u" />
                                <input type="hidden" id="Id_Empresa_u" />

                                <span class="span FWM-span-form">Jornada</span>
                                <input
                                    type="text"
                                    id="jornada_u"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="50"
                                />

                                <span class="span FWM-span-form">Vueltas</span>
                                <input
                                    type="number"
                                    id="vueltas_u"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                />

                                <span class="span FWM-span-form"
                                    >Hora Inicio</span
                                >
                                <input
                                    type="time"
                                    id="h_inicio_u"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                />

                                <span class="span FWM-span-form">Hora Fin</span>
                                <input
                                    type="time"
                                    id="h_fin_u"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                    maxlength="20"
                                    onchange="check_hours_menores('h_inicio_u','h_fin_u');"
                                />

                                <span class="span FWM-span-form"
                                    >Comentarios</span
                                >
                                <input
                                    type="text"
                                    id="comentariosDiesel_u"
                                    class="FWM-input"
                                    style="padding-right: 5px"
                                />

                                <div
                                    class="block grid-resizable-demo"
                                    style="margin-bottom: 70px"
                                >
                                    <div
                                        class="row align-items-stretch"
                                        style="text-align: center"
                                    >
                                        <div
                                            class="col-100 medium-50"
                                            style="
                                                min-width: 50px;
                                                border-style: none;
                                            "
                                        >
                                            <span class="resize-handler"></span>
                                            <a
                                                href="#"
                                                onclick="actualizaCargaDiesel();"
                                                style="
                                                    background-color: #ff0037;
                                                "
                                                class="boton-equipo"
                                                >Guardar</a
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- fin modals -->
            </div>
            <div style="height: 100px"></div>
        </div>
    </div>
</template>
<script>
    return {
        on: {
            pageInit: function () {
                var empresa = localStorage.getItem("empresa");
                var self = this;
                var app = self.$app;
                var NomJson = "Unidades_empresa" + empresa;
                var NomDescCli = "Unidades_empresa" + empresa;
                var accion = 0;

                app.preloader.show("red");

                databaseHandler.db.transaction(
                    function (tx5) {
                        tx5.executeSql(
                            "SELECT fecha, id_empresa, bomba_def, carga_def, personal,bomba_def2, carga_def2, personal2 FROM datos_generales_diesel WHERE id_cedula = ?",
                            [localStorage.getItem("IdCedula")],
                            function (tx5, results) {
                                var item = results.rows.item(0);
                                var fecha = item.fecha.split(" ");
                                $("#name_empresa").html(
                                    NombreEmpresa(item.id_empresa)
                                );
                                $("#bomba_def_d").html(item.bomba_def);
                                $("#carga_def_d").html(
                                    numberWithCommas(Number(item.carga_def))
                                );
                                $("#fecha").html(fecha[0]);
                                $("#personalM").html(item.personal);
                                let option = `<option value="0">Selecciona una opción</option> <option value="${item.bomba_def}">${item.bomba_def}</option>`;
                                $("#bomba_c").html(option);
                                $("#bomba_u").html(option);
                                if (item.bomba_def2 != 0) {
                                    $("#bomba_c").append(
                                        `<option value="${item.bomba_def2}">${item.bomba_def2}</option>`
                                    );
                                    $("#bomba_u").append(
                                        `<option value="${item.bomba_def2}">${item.bomba_def2}</option>`
                                    );
                                    $("#div_bomba2").css("display", "flex");
                                    $("#div_totalizador").css(
                                        "display",
                                        "flex"
                                    );
                                    $("#div_bombero").css("display", "flex");
                                    $("#bomba_def_d2").html(item.bomba_def2);
                                    $("#carga_def_d2").html(
                                        numberWithCommas(
                                            Number(item.carga_def2)
                                        )
                                    );
                                    $("#personalM2").html(item.personal2);
                                }
                            },
                            function (tx5, error) {
                                console.error("Error: " + error.message);
                            }
                        );
                    },
                    function (error) {
                        console.error("Error: " + error.message);
                    },
                    function (error) {
                        console.error("Error: " + error.message);
                    }
                );

                var id_cedula = localStorage.getItem("IdCedula");
                databaseHandler.db.transaction(
                    function (tx5) {
                        tx5.executeSql(
                            "SELECT * FROM detalle_diesel WHERE id_cedula = ?",
                            [id_cedula],
                            function (tx5, results) {
                                var length = results.rows.length;
                                if (length == 0) {
                                    $("#message-nr").css("display", "block");
                                    $("#total_litros").html(
                                        `${numberWithCommas(0)}`
                                    );
                                    $("#carga_restantes").html(
                                        `${numberWithCommas(
                                            Number(
                                                String(
                                                    $("#carga_def_d").html()
                                                ).replaceAll(",", "")
                                            ).toFixed(2)
                                        )}`
                                    );
                                    app.preloader.hide();
                                } else {
                                    $("#message-nr").css("display", "none");
                                    for (var i = 0; i < length; i++) {
                                        var item2 = results.rows.item(i);
                                        var no_bomba = "";
                                        item2.no_bomba
                                            ? (no_bomba = item2.no_bomba)
                                            : (no_bomba = 0);
                                        $("#tb_diesel").append(
                                            `<tr><td>${item2.eco2}</td><td>${
                                                Number(item2.carga_total) > 0
                                                    ? numberWithCommas(
                                                          item2.carga_total
                                                      )
                                                    : '<span style="color:#FF0037"> SIN CARGA </span>'
                                            }</td><td>${numberWithCommas(
                                                item2.odometro
                                            )}</td><td>${no_bomba}</td><td>${
                                                item2.tipo_carga
                                            }</td><td><button class='col button button-small button-round button-outline edit-btn' style='height: 100%;border-color: #FF0037;margin-top: 15px;margin-bottom: 15px;height: 60px !important;width: 60px;' onclick="editarCargaDiesel('${
                                                item2.id_detalle
                                            }','${item2.id_unidad}','${
                                                item2.eco
                                            }','${item2.carga_total}','${
                                                item2.odometro
                                            }','${item2.no_bomba}','${
                                                item2.almacen
                                            }','${item2.h_fin}','${
                                                item2.h_inicio
                                            }','${item2.jornada}','${
                                                item2.operador
                                            }','${item2.id_operador}','${
                                                item2.vueltas
                                            }','${item2.tipo_carga}','${
                                                item2.operador2
                                            }','${item2.VIN}','2','${
                                                item2.eco2
                                            }','${item2.comentarios}','${
                                                item2.Id_Empresa
                                            }','${
                                                item2.totalizador
                                            }');"><i class='material-icons md-light' style='color: #FF0037;vertical-align: middle;font-size: 40px;'>edit</i></button></td></tr>`
                                        );
                                    }
                                    databaseHandler.db.transaction(
                                        function (tx5) {
                                            tx5.executeSql(
                                                "SELECT SUM(carga_total) as carga_totales, COUNT(id_cedula) as cuentas FROM detalle_diesel WHERE id_cedula = ?",
                                                [id_cedula],
                                                function (tx5, results) {
                                                    var item3 =
                                                        results.rows.item(0);
                                                    $("#total_litros").html(
                                                        `${numberWithCommas(
                                                            Number(
                                                                item3.carga_totales
                                                            ).toFixed(2)
                                                        )}`
                                                    );
                                                    $("#carga_restantes").html(
                                                        `${numberWithCommas(
                                                            Number(
                                                                String(
                                                                    $(
                                                                        "#carga_def_d"
                                                                    ).html()
                                                                ).replaceAll(
                                                                    ",",
                                                                    ""
                                                                )
                                                            ).toFixed(2) -
                                                                Number(
                                                                    item3.carga_totales
                                                                ).toFixed(2)
                                                        )}`
                                                    );
                                                    $(
                                                        "#unidades_cargadas"
                                                    ).html(`${item3.cuentas}`);
                                                    $("#tb_diesel").append(
                                                        `<tr id="row_totales" style="text-align: center;background-color: #005D99;color: white;font-weight: bold;"><th>Totales</th><th>${numberWithCommas(
                                                            Number(
                                                                item3.carga_totales
                                                            ).toFixed(2)
                                                        )}</th><th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th></tr>`
                                                    );
                                                    $("#autocomplete").val("");
                                                    app.preloader.hide();
                                                },
                                                function (tx5, error) {
                                                    console.error(
                                                        "Error: " +
                                                            error.message
                                                    );
                                                }
                                            );
                                        },
                                        function (error) {
                                            console.error(
                                                "Error: " + error.message
                                            );
                                        },
                                        function (error) {
                                            console.error(
                                                "Error: " + error.message
                                            );
                                        }
                                    );
                                }
                            },
                            function (tx5, error) {
                                console.error("Error: " + error.message);
                            }
                        );
                    },
                    function (error) {
                        console.error("Error: " + error.message);
                    },
                    function (error) {
                        console.error("Error: " + error.message);
                    }
                );

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                /////////////////////////////////////////                      UNIDADES                      //////////////////////////////////////////////////////////////
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                self.autocompleteDropdownAjax = app.autocomplete.create({
                    inputEl: "#autocomplete",
                    openIn: "dropdown",
                    preloader: true, //enable preloader
                    valueProperty: "id_unidad", //object's "value" property name
                    textProperty: "buscador", //object's "text" property name
                    limit: 10, //limit to [number] results
                    dropdownPlaceholderText: "Selecciona una Unidad...",
                    source: function (query, render) {
                        var autocomplete = this;
                        var results = [];
                        if (query.length === 0) {
                            render(results);
                            return;
                        }
                        autocomplete.preloaderShow();
                        app.request({
                            url:
                                cordova.file.dataDirectory +
                                "jsons_Diesel/" +
                                NomDescCli +
                                ".json",
                            method: "GET",
                            dataType: "json",
                            data: {
                                query: query,
                            },
                            success: function (data) {
                                for (var i = 0; i < data.length; i++) {
                                    if (
                                        data[i].buscador
                                            .toLowerCase()
                                            .indexOf(query.toLowerCase()) >= 0
                                    )
                                        results.push(data[i]);
                                }
                                autocomplete.preloaderHide();
                                render(results);
                            },
                        });
                    },
                });

                $("#autocomplete").change(function () {
                    var unidad = $("#autocomplete").val();
                    var encontro = false;
                    app.request.get(
                        cordova.file.dataDirectory +
                            "jsons_Diesel/" +
                            NomDescCli +
                            ".json",
                        function (data) {
                            var content = JSON.parse(data);
                            for (var x = 0; x < content.length; x++) {
                                if (content[x].id_unidad == unidad) {
                                    $("#autocomplete").val(content[x].buscador);
                                    $("#btn_llamarUnidad").data({
                                        id_unidad: content[x].id_unidad,
                                        Unidad: content[x].Unidad,
                                        VIN: content[x].VIN,
                                        buscador: content[x].buscador,
                                        Id_Empresa: content[x].Id_Empresa,
                                    });
                                    $("#modelos").val(content[x].Modelo);
                                    //llamarUnidadDiesel(content[x].id_unidad, content[x].Unidad, paso)
                                    encontro = true;
                                }
                            }
                            if (!encontro) {
                                $("#autocomplete").val("");
                                $("#btn_llamarUnidad").removeData();
                                $("#modelos").val("");
                            }
                        }
                    );
                });

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                /////////////////////////////////////////                      UNIDADES EDIT                   //////////////////////////////////////////////////////////////
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                self.autocompleteDropdownAjax = app.autocomplete.create({
                    inputEl: "#unidad_u",
                    openIn: "dropdown",
                    preloader: true, //enable preloader
                    valueProperty: "id_unidad", //object's "value" property name
                    textProperty: "buscador", //object's "text" property name
                    limit: 10, //limit to [number] results
                    dropdownPlaceholderText: "Selecciona una Unidad...",
                    source: function (query, render) {
                        var autocomplete = this;
                        var results = [];
                        if (query.length === 0) {
                            render(results);
                            return;
                        }
                        autocomplete.preloaderShow();
                        app.request({
                            url:
                                cordova.file.dataDirectory +
                                "jsons_Diesel/" +
                                NomDescCli +
                                ".json",
                            method: "GET",
                            dataType: "json",
                            data: {
                                query: query,
                            },
                            success: function (data) {
                                for (var i = 0; i < data.length; i++) {
                                    if (
                                        data[i].buscador
                                            .toLowerCase()
                                            .indexOf(query.toLowerCase()) >= 0
                                    )
                                        results.push(data[i]);
                                }
                                autocomplete.preloaderHide();
                                render(results);
                            },
                        });
                    },
                });

                $("#unidad_u").change(function () {
                    var unidad = $("#unidad_u").val();
                    var encontro = false;
                    app.request.get(
                        cordova.file.dataDirectory +
                            "jsons_Diesel/" +
                            NomDescCli +
                            ".json",
                        function (data) {
                            var content = JSON.parse(data);
                            for (var x = 0; x < content.length; x++) {
                                if (content[x].id_unidad == unidad) {
                                    $("#unidad_u").val(content[x].Unidad);
                                    $("#id_unidad_u").val(content[x].id_unidad);
                                    $("#VIN_u").val(content[x].VIN);
                                    $("#title_unidad_u").html(
                                        `Unidad: ${content[x].buscador}`
                                    );
                                    $("#modelos").val(content[x].Modelo);
                                    $("#Id_Empresa_u").val(
                                        content[x].Id_Empresa
                                    );
                                    encontro = true;
                                }
                            }
                            if (!encontro) {
                                $("#id_unidad_u").val("");
                                $("#unidad_u").val("");
                                $("#VIN_u").val("");
                                $("#modelos").val("");
                                $("#Id_Empresa_u").val("");
                            }
                        }
                    );
                });

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                /////////////////////////////////////////                      OPERADORES                      //////////////////////////////////////////////////////////////
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                var carpeta = "jsons_Diesel";
                var NomJson2 = "Operadores_" + empresa;
                self.autocompleteDropdownAjax = app.autocomplete.create({
                    inputEl: "#operador",
                    openIn: "dropdown",
                    preloader: true, //enable preloader
                    valueProperty: "id_ope", //object's "value" property name
                    textProperty: "buscador", //object's "text" property name
                    limit: 10, //limit to [number] results
                    dropdownPlaceholderText: "Selecciona una Operador...",
                    source: function (query, render) {
                        var autocomplete = this;
                        var results = [];
                        if (query.length === 0) {
                            render(results);
                            return;
                        }
                        autocomplete.preloaderShow();
                        app.request({
                            url:
                                cordova.file.dataDirectory +
                                carpeta +
                                "/" +
                                NomJson2 +
                                ".json",
                            method: "GET",
                            dataType: "json",
                            data: {
                                query: query,
                            },
                            success: function (data) {
                                for (var i = 0; i < data.length; i++) {
                                    if (
                                        data[i].buscador
                                            .toLowerCase()
                                            .indexOf(query.toLowerCase()) >= 0
                                    )
                                        results.push(data[i]);
                                }
                                autocomplete.preloaderHide();
                                render(results);
                            },
                        });
                    },
                });

                $("#operador").change(function () {
                    var operador = $("#operador").val();
                    var encontro = false;
                    app.request.get(
                        cordova.file.dataDirectory +
                            "jsons_Diesel/" +
                            NomJson2 +
                            ".json",
                        function (data) {
                            var content5 = JSON.parse(data);
                            for (var x = 0; x < content5.length; x++) {
                                if (content5[x].id_ope == operador) {
                                    $("#operador").val(content5[x].buscador);
                                    $("#id_operador").val(content5[x].id_ope);
                                    $("#operador2").val(content5[x].Operador2);
                                    encontro = true;
                                }
                            }
                            if (!encontro) {
                                $("#operador").val("");
                                $("#id_operador").val("");
                                $("#operador2").val("");
                            }
                        }
                    );
                });

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                /////////////////////////////////////////                   OPERADORES EDIT                    //////////////////////////////////////////////////////////////
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                var carpeta2 = "jsons_Diesel";
                var NomJson3 = "Operadores_" + empresa;
                self.autocompleteDropdownAjax = app.autocomplete.create({
                    inputEl: "#operador_u",
                    openIn: "dropdown",
                    preloader: true, //enable preloader
                    valueProperty: "id_ope", //object's "value" property name
                    textProperty: "buscador", //object's "text" property name
                    limit: 10, //limit to [number] results
                    dropdownPlaceholderText: "Selecciona una Operador...",
                    source: function (query, render) {
                        var autocomplete = this;
                        var results = [];
                        if (query.length === 0) {
                            render(results);
                            return;
                        }
                        autocomplete.preloaderShow();
                        app.request({
                            url:
                                cordova.file.dataDirectory +
                                carpeta2 +
                                "/" +
                                NomJson3 +
                                ".json",
                            method: "GET",
                            dataType: "json",
                            data: {
                                query: query,
                            },
                            success: function (data) {
                                for (var i = 0; i < data.length; i++) {
                                    if (
                                        data[i].buscador
                                            .toLowerCase()
                                            .indexOf(query.toLowerCase()) >= 0
                                    )
                                        results.push(data[i]);
                                }
                                autocomplete.preloaderHide();
                                render(results);
                            },
                        });
                    },
                });

                $("#operador_u").change(function () {
                    var operador = $("#operador_u").val();
                    var encontro = false;
                    app.request.get(
                        cordova.file.dataDirectory +
                            "jsons_Diesel/" +
                            NomJson3 +
                            ".json",
                        function (data) {
                            var content5 = JSON.parse(data);
                            for (var x = 0; x < content5.length; x++) {
                                if (content5[x].id_ope == operador) {
                                    $("#operador_u").val(content5[x].buscador);
                                    $("#id_operador_u").val(content5[x].id_ope);
                                    $("#operador2_u").val(
                                        content5[x].Operador2
                                    );
                                    encontro = true;
                                }
                            }
                            if (!encontro) {
                                $("#operador_u").val("");
                                $("#id_operador_u").val("");
                                $("#operador2_u").val("");
                            }
                        }
                    );
                });

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///////////////////////////////////////                  FIN OPERADORES EDIT                    /////////////////////////////////////////////////////////////
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                app.sheet.create({
                    el: ".my-sheet",
                    swipeToClose: false,
                    closeByOutsideClick: false,
                    closeByBackdropClick: false,
                    closeOnEscape: false,
                });

                app.sheet.create({
                    el: ".my-sheet-u",
                    swipeToClose: false,
                    closeByOutsideClick: false,
                    closeByBackdropClick: false,
                    closeOnEscape: false,
                });

                $("#carga").on("keydown", function (e) {
                    if (e.key == "0") {
                        if (this.value) {
                        } else {
                            $("#carga").on("input", function (e) {
                                $(this).val($(this).val().replace(/^0/, ""));
                            });
                        }
                    }
                });
            },
        },
    };
</script>
